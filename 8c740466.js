import{S as e,i as t,s as n,e as r,a as i,b as s,c as o,t as a,d as c,f as u,g as l,r as v,l as d,h,j as f,k as p,n as g,m as b,o as x,p as m}from"./3a999be9.js";import{s as y,r as w,w as E}from"./b634f6de.js";import{g as S,c as B,u as O}from"./56db2494.js";import{s as k}from"./79ba4c64.js";import{r as j,c as M}from"./2ac5f3e3.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var D;!function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"}(D||(D={}));var G={type:"xstate.init"},L="xstate.assign";function _(e){return void 0===e?[]:[].concat(e)}function F(e){return{type:L,assignment:e}}function R(e,t){return"string"==typeof(e="string"==typeof e&&t&&t[e]?t[e]:e)?{type:e}:"function"==typeof e?{type:e.name,exec:e}:e}function T(e){return function(t){return e===t}}function $(e){return"string"==typeof e?{type:e}:e}function C(e,t){return{value:e,context:t,actions:[],changed:!1,matches:T(e)}}function z(e,t){void 0===t&&(t={});var n={config:e,_options:t,initialState:{value:e.initial,actions:_(e.states[e.initial].entry).map((function(e){return R(e,t.actions)})),context:e.context,matches:T(e.initial)},transition:function(t,r){var i,s,o="string"==typeof t?{value:t,context:e.context}:t,a=o.value,c=o.context,u=$(r),l=e.states[a];if(l.on){var v=_(l.on[u.type]),d=function(t){if(void 0===t)return{value:C(a,c)};var r="string"==typeof t?{target:t}:t,i=r.target,s=void 0===i?a:i,o=r.actions,v=void 0===o?[]:o,d=r.cond,h=c;if((void 0===d?function(){return!0}:d)(c,u)){var f=e.states[s],p=!1,g=[].concat(l.exit,v,f.entry).filter((function(e){return e})).map((function(e){return R(e,n._options.actions)})).filter((function(e){if(e.type===L){p=!0;var t=Object.assign({},h);return"function"==typeof e.assignment?t=e.assignment(h,u):Object.keys(e.assignment).forEach((function(n){t[n]="function"==typeof e.assignment[n]?e.assignment[n](h,u):e.assignment[n]})),h=t,!1}return!0}));return{value:{value:s,context:h,actions:g,changed:s!==a||g.length>0||p,matches:T(s)}}}};try{for(var h=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(v),f=h.next();!f.done;f=h.next()){var p=d(f.value);if("object"==typeof p)return p.value}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}}return C(a,c)}};return n}var A=function(e,t){return e.actions.forEach((function(n){var r=n.exec;return r&&r(e.context,t)}))};var N=Object.freeze({__proto__:null,get InterpreterStatus(){return D},assign:F,createMachine:z,interpret:function(e){var t=e.initialState,n=D.NotStarted,r=new Set,i={_machine:e,send:function(i){n===D.Running&&(t=e.transition(t,i),A(t,$(i)),r.forEach((function(e){return e(t)})))},subscribe:function(e){return r.add(e),e(t),{unsubscribe:function(){return r.delete(e)}}},start:function(){return n=D.Running,A(t,G),i},stop:function(){return n=D.Stopped,r.forEach((function(e){return r.delete(e)})),i},get status(){return n}};return i}}),I=S(y),V=B((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useService=t.useMachine=void 0;var n=function(e){var t;return e.subscribe((function(e){t=e})).unsubscribe(),t};t.useMachine=function(e,t){var r=N.interpret(N.createMachine(e.config,t||e._options)).start();return{state:I.readable(n(r),(function(e){return r.subscribe(e),function(){r.stop()}})),send:r.send,service:r}},t.useService=function(e){return{state:I.readable(n(e),(function(t){var n=e.subscribe((function(e){!1!==e.changed&&t(e)})).unsubscribe;return function(){return n()}})),send:e.send,service:e}}}));O(V),V.useService;var q=V.useMachine;function H(e){let t,n,r;return{c(){t=o("svg"),n=o("circle"),r=o("path"),c(n,"cx","35"),c(n,"cy","35"),c(n,"r","35"),c(n,"fill","#6360FF"),c(r,"d","M49 31.54a4 4 0 010 6.92l-18 10.4a4 4 0 01-6-3.47V24.61a4 4 0\n            016-3.47l18 10.4z"),c(r,"fill","#EDEDED"),c(t,"width","70"),c(t,"height","70"),c(t,"viewBox","0 0 70 70"),c(t,"fill","none"),c(t,"xmlns","http://www.w3.org/2000/svg")},m(e,s){l(e,t,s),i(t,n),i(t,r)},d(e){e&&f(t)}}}function P(e){let t,n,r,s;return{c(){t=o("svg"),n=o("circle"),r=o("rect"),s=o("rect"),c(n,"cx","35"),c(n,"cy","35"),c(n,"r","35"),c(n,"fill","#6360FF"),c(r,"x","39"),c(r,"y","20"),c(r,"width","9"),c(r,"height","30"),c(r,"rx","4.5"),c(r,"fill","#EDEDED"),c(s,"x","22"),c(s,"y","20"),c(s,"width","9"),c(s,"height","30"),c(s,"rx","4.5"),c(s,"fill","#EDEDED"),c(t,"width","70"),c(t,"height","70"),c(t,"viewBox","0 0 70 70"),c(t,"fill","none"),c(t,"xmlns","http://www.w3.org/2000/svg")},m(e,o){l(e,t,o),i(t,n),i(t,r),i(t,s)},d(e){e&&f(t)}}}function W(e){let t;return{c(){t=r("div"),c(t,"class","loading svelte-1hrev6i")},m(e,n){l(e,t,n)},d(e){e&&f(t)}}}function J(e){let t,n,b,x,m,y,w,E,S,B,O,k,M,D,G,L,_,F,R,T,$,C,z,A,N,I,V,q=e[1].matches("start")||e[1].matches("loading"),J=e[3].width+"",K=e[3].height+"";function Q(e,t){return(null==y||2&t)&&(y=!!e[1].matches("play")),y?P:H}let U=Q(e,-1),X=U(e),Y=q&&W();return{c(){t=r("div"),n=r("span"),n.textContent="WARNING: russian speech",b=s(),x=r("div"),m=r("button"),X.c(),w=s(),E=r("div"),S=o("svg"),B=o("path"),M=s(),D=r("div"),G=o("svg"),L=o("path"),R=s(),Y&&Y.c(),T=s(),$=r("div"),C=a(e[2]),z=a(" | "),A=a(J),N=a("x"),I=a(K),c(n,"class","svelte-1hrev6i"),c(m,"class","svelte-1hrev6i"),c(B,"d",O=e[0].d),c(S,"viewBox",k=e[0].box),c(S,"class","svelte-1hrev6i"),c(L,"d",_=e[0].d),c(G,"viewBox",F=e[0].box),c(G,"class","svelte-1hrev6i"),u(D,"--dur",e[2]),c(D,"class","svelte-1hrev6i"),c(E,"class","bars svelte-1hrev6i"),c(x,"class","container svelte-1hrev6i"),c($,"class","debug svelte-1hrev6i"),c(t,"class","example svelte-1hrev6i")},m(r,s,o){l(r,t,s),i(t,n),i(t,b),i(t,x),i(x,m),X.m(m,null),i(x,w),i(x,E),i(E,S),i(S,B),i(E,M),i(E,D),i(D,G),i(G,L),i(x,R),Y&&Y.m(x,null),i(t,T),i(t,$),i($,C),i($,z),i($,A),i($,N),i($,I),o&&v(V),V=[d(m,"click",e[13]),h(j.call(null,E)),d(E,"resize",e[5])]},p(e,[t]){U!==(U=Q(e,t))&&(X.d(1),X=U(e),X&&(X.c(),X.m(m,null))),1&t&&O!==(O=e[0].d)&&c(B,"d",O),1&t&&k!==(k=e[0].box)&&c(S,"viewBox",k),1&t&&_!==(_=e[0].d)&&c(L,"d",_),1&t&&F!==(F=e[0].box)&&c(G,"viewBox",F),4&t&&u(D,"--dur",e[2]),2&t&&(q=e[1].matches("start")||e[1].matches("loading")),q?Y||(Y=W(),Y.c(),Y.m(x,null)):Y&&(Y.d(1),Y=null),4&t&&p(C,e[2]),8&t&&J!==(J=e[3].width+"")&&p(A,J),8&t&&K!==(K=e[3].height+"")&&p(I,K)},i:g,o:g,d(e){e&&f(t),X.d(),Y&&Y.d(),v(V)}}}function K(e,t,n){let r,i,s;const[o,a]=M({});b(e,o,e=>n(3,s=e));const c=w(0,e=>{let t;const n=r=>{e(r),t=window.requestAnimationFrame(n)};return n(0),()=>window.cancelAnimationFrame(t)});let u=()=>{};const l=E("0%");b(e,l,e=>n(2,i=e));let v={};const d=z({id:"player",initial:"start",context:{context:new(window.AudioContext||window.webkitAudioContext),audioBuffer:void 0,source:void 0,unsubscribe:void 0},states:{start:{on:{FETCH:"loading"}},loading:{entry:["load"],on:{RESOLVE:{target:"idle",actions:F((e,t)=>({...e,audioBuffer:t.audioBuffer}))}}},idle:{entry:["initStream"],on:{TOGGLE:{target:"play"}}},pause:{entry:["pause"],on:{TOGGLE:{target:"play"}}},play:{entry:["play","subOnEnd"],exit:["unsubOnEnd"],on:{TOGGLE:{target:"pause"}}}}}),h=e=>(...t)=>new Promise((n,r)=>{Reflect.apply(e,void 0,[...t,e=>n(e),e=>r(e)])}),{state:f,send:p}=q(d,{actions:{load:({context:e})=>{const t=h(e.decodeAudioData.bind(e));window.fetch(new window.Request("f56c0a56ba2ead64.m4a")).then(e=>e.arrayBuffer()).then(e=>t(e)).then(e=>({audioBuffer:e})).then(({audioBuffer:e})=>{console.log(e),o.subscribe(({width:t,height:r})=>{t&&r&&n(0,v=function(e,{width:t,height:n,size:r=5,gap:i=1}){const s=~~((n-r)/2),o=~~((t-r+i)/(r+i)),a=e.length/o,c=~~(a/10)||1,u=e.getChannelData(0);let l=[],v=0;for(let e=0;e<o;e++){const t=~~(e*a),n=~~(t+a);let r=u[0];for(let e=t;e<n;e+=c){const t=u[e];r=Math.max(Math.abs(t),r)}v=Math.max(v,r),l[e]=r}return l=l.map(e=>~~(e/v*s)),{box:`0 -${~~(n/2)} ${t} ${n}`,d:l.map((e,t)=>{const n=t*(r+i)+Math.ceil(r/2);return`M${n}, ${e} L${n}, ${-e}`}).join(" ")}}(e,{width:t,height:r}))}),p({type:"RESOLVE",audioBuffer:e})})},initStream:({audioBuffer:e})=>{console.log("ready 💪🏻")},pause:F(e=>{const{source:t,context:n}=e;return t.disconnect(n.destination),t.stop(),u(),{...e,source:void 0}}),play:F(e=>{const{audioBuffer:t,context:n}=e,r=n.createBufferSource();r.buffer=t,r.connect(n.destination),r.start(0,0);const i=n.currentTime;return u=c.subscribe(()=>{const e=(n.currentTime-i)/t.duration*100;l.set(`${e.toFixed(2)}%`)}),k.track("play audio message"),{...e,source:r}}),subOnEnd:F(e=>{const{source:t}=e,n=()=>p({type:"TOGGLE"});return t.addEventListener("ended",n),{...e,unsubscribe:()=>t.removeEventListener("ended",n)}}),unsubOnEnd:({unsubscribe:e})=>{e&&e()}}});b(e,f,e=>n(1,r=e)),x(()=>{p("FETCH")});return[v,r,i,s,o,a,l,f,p,u,c,d,h,()=>p("TOGGLE")]}var Q=m(class extends e{constructor(e){var s;super(),document.getElementById("svelte-1hrev6i-style")||((s=r("style")).id="svelte-1hrev6i-style",s.textContent=".example.svelte-1hrev6i.svelte-1hrev6i.svelte-1hrev6i{display:flex;flex-direction:column}.example.svelte-1hrev6i.svelte-1hrev6i>span.svelte-1hrev6i.svelte-1hrev6i{color:#474747;font-family:monospace;padding-bottom:6px}.container.svelte-1hrev6i.svelte-1hrev6i.svelte-1hrev6i{--height:100px;display:flex;position:relative;height:var(--height);width:100%;background-color:#ededed;border-radius:24px}button.svelte-1hrev6i.svelte-1hrev6i.svelte-1hrev6i{display:block;box-sizing:border-box;margin:15px 20px;padding:0px;background-color:transparent;color:white;border:none;outline:none}.bars.svelte-1hrev6i.svelte-1hrev6i.svelte-1hrev6i{width:100%;position:relative;height:calc(100% - 30px);margin:15px 20px 15px 0}.bars.svelte-1hrev6i.svelte-1hrev6i svg.svelte-1hrev6i.svelte-1hrev6i{height:100%;width:100%;stroke-width:5px;stroke-linecap:round}.bars.svelte-1hrev6i.svelte-1hrev6i>svg.svelte-1hrev6i.svelte-1hrev6i{stroke:#c7c7c7}.bars.svelte-1hrev6i.svelte-1hrev6i>div.svelte-1hrev6i.svelte-1hrev6i{position:absolute;top:0;left:0;width:100%;height:100%;clip-path:polygon(0 0, var(--dur) 0, var(--dur) 100%, 0% 100%);-webkit-clip-path:polygon(0 0, var(--dur) 0, var(--dur) 100%, 0% 100%)}.bars.svelte-1hrev6i>div.svelte-1hrev6i>svg.svelte-1hrev6i{stroke:#6360ff}.loading.svelte-1hrev6i.svelte-1hrev6i.svelte-1hrev6i{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background-color:#ededed;border-radius:24px}.debug.svelte-1hrev6i.svelte-1hrev6i.svelte-1hrev6i{padding-top:6px;align-self:flex-end;color:#474747;font-family:monospace;z-index:1}",i(document.head,s)),t(this,e,K,J,n,{})}});export default Q;
